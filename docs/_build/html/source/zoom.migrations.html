
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>zoom.migrations module &#8212; zoom 0.1 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="module-zoom.migrations">
<span id="zoom-migrations-module"></span><h1>zoom.migrations module<a class="headerlink" href="#module-zoom.migrations" title="Permalink to this headline">¶</a></h1>
<p>zoom.migrations</p>
<p>Work in progress - experimental</p>
<dl class="class">
<dt id="zoom.migrations.Migration">
<em class="property">class </em><code class="descclassname">zoom.migrations.</code><code class="descname">Migration</code><span class="sig-paren">(</span><em>db</em><span class="sig-paren">)</span><a class="headerlink" href="#zoom.migrations.Migration" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Provies the methods to apply or revert transformations
to get system to a desired state.</p>
<dl class="method">
<dt id="zoom.migrations.Migration.apply">
<code class="descname">apply</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#zoom.migrations.Migration.apply" title="Permalink to this definition">¶</a></dt>
<dd><p>apply changes to the database</p>
</dd></dl>

<dl class="attribute">
<dt id="zoom.migrations.Migration.name">
<code class="descname">name</code><a class="headerlink" href="#zoom.migrations.Migration.name" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="zoom.migrations.Migration.revert">
<code class="descname">revert</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#zoom.migrations.Migration.revert" title="Permalink to this definition">¶</a></dt>
<dd><p>Revert changes to the database</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="zoom.migrations.Migrations">
<em class="property">class </em><code class="descclassname">zoom.migrations.</code><code class="descname">Migrations</code><span class="sig-paren">(</span><em>db</em>, <em>steps</em><span class="sig-paren">)</span><a class="headerlink" href="#zoom.migrations.Migrations" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>performs the migration steps needed to get to the target version</p>
<p>Systems are migrated from one state to another by providing a sequence
of steps typically subclassed from the Migration class.  Migrations
should provide both an apply method to peform a transformation to take a
system to a desired state and, where possible, a revert method to undo the
transformation to transform the sytem back to its original state.</p>
<p>As they are applied and reverted, the migrations are tracked in a
data store including the name of the object peforming the migration (
usually a subclass of Migration) the version of the system that was
attained by applying or reverting the migration, the revision number
of the migration (an integer representing the application or reversion
of a transformation), the method used (apply or revert) and the timestamp
of when the migration took place.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">AddFaxColumnToUser</span><span class="p">(</span><span class="n">Migration</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">(</span><span class="s1">&#39;alter table users add column fax char(30)&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">revert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">(</span><span class="s1">&#39;alter table users drop column fax&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">steps</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">... </span>    <span class="n">StartMigration</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">AddFaxColumnToUser</span><span class="p">,</span>
<span class="gp">... </span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">zoom</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span> <span class="o">=</span> <span class="n">zoom</span><span class="o">.</span><span class="n">sites</span><span class="o">.</span><span class="n">Site</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">site</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">zoom</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">setup_test</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">db</span><span class="p">(</span><span class="s1">&#39;describe users&#39;</span><span class="p">))</span>
<span class="go">Field      Type             Null Key Default Extra</span>
<span class="go">---------- ---------------- ---- --- ------- --------------</span>
<span class="go">id         int(10) unsigned NO   PRI None    auto_increment</span>
<span class="go">username   char(50)         NO   UNI None</span>
<span class="go">password   varchar(125)     YES      None</span>
<span class="go">first_name char(40)         YES      None</span>
<span class="go">last_name  char(40)         YES      None</span>
<span class="go">email      char(60)         YES  MUL None</span>
<span class="go">phone      char(30)         YES      None</span>
<span class="go">created    datetime         YES      None</span>
<span class="go">updated    datetime         YES      None</span>
<span class="go">last_seen  datetime         YES  MUL None</span>
<span class="go">created_by int(10) unsigned YES      None</span>
<span class="go">updated_by int(10) unsigned YES      None</span>
<span class="go">status     char(1)          YES      None</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">migrations</span> <span class="o">=</span> <span class="n">Migrations</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="n">steps</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">migrations</span><span class="o">.</span><span class="n">migrate</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">db</span><span class="p">(</span><span class="s1">&#39;describe users&#39;</span><span class="p">))</span>
<span class="go">Field      Type             Null Key Default Extra</span>
<span class="go">---------- ---------------- ---- --- ------- --------------</span>
<span class="go">id         int(10) unsigned NO   PRI None    auto_increment</span>
<span class="go">username   char(50)         NO   UNI None</span>
<span class="go">password   varchar(125)     YES      None</span>
<span class="go">first_name char(40)         YES      None</span>
<span class="go">last_name  char(40)         YES      None</span>
<span class="go">email      char(60)         YES  MUL None</span>
<span class="go">phone      char(30)         YES      None</span>
<span class="go">created    datetime         YES      None</span>
<span class="go">updated    datetime         YES      None</span>
<span class="go">last_seen  datetime         YES  MUL None</span>
<span class="go">created_by int(10) unsigned YES      None</span>
<span class="go">updated_by int(10) unsigned YES      None</span>
<span class="go">status     char(1)          YES      None</span>
<span class="go">fax        char(30)         YES      None</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">migrations</span><span class="o">.</span><span class="n">migrate</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">db</span><span class="p">(</span><span class="s1">&#39;describe users&#39;</span><span class="p">))</span>
<span class="go">Field      Type             Null Key Default Extra</span>
<span class="go">---------- ---------------- ---- --- ------- --------------</span>
<span class="go">id         int(10) unsigned NO   PRI None    auto_increment</span>
<span class="go">username   char(50)         NO   UNI None</span>
<span class="go">password   varchar(125)     YES      None</span>
<span class="go">first_name char(40)         YES      None</span>
<span class="go">last_name  char(40)         YES      None</span>
<span class="go">email      char(60)         YES  MUL None</span>
<span class="go">phone      char(30)         YES      None</span>
<span class="go">created    datetime         YES      None</span>
<span class="go">updated    datetime         YES      None</span>
<span class="go">last_seen  datetime         YES  MUL None</span>
<span class="go">created_by int(10) unsigned YES      None</span>
<span class="go">updated_by int(10) unsigned YES      None</span>
<span class="go">status     char(1)          YES      None</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">migrations</span><span class="o">.</span><span class="n">revisions</span><span class="o">.</span><span class="n">zap</span><span class="p">()</span>
</pre></div>
</div>
<dl class="method">
<dt id="zoom.migrations.Migrations.migrate">
<code class="descname">migrate</code><span class="sig-paren">(</span><em>target=None</em><span class="sig-paren">)</span><a class="headerlink" href="#zoom.migrations.Migrations.migrate" title="Permalink to this definition">¶</a></dt>
<dd><p>migrate to a target version</p>
<p>Target is the desired version.  If no target is supplied the
migrations required to get to the most up to date version are
applied.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="zoom.migrations.StartMigration">
<em class="property">class </em><code class="descclassname">zoom.migrations.</code><code class="descname">StartMigration</code><span class="sig-paren">(</span><em>db</em><span class="sig-paren">)</span><a class="headerlink" href="#zoom.migrations.StartMigration" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#zoom.migrations.Migration" title="zoom.migrations.Migration"><code class="xref py py-class docutils literal notranslate"><span class="pre">zoom.migrations.Migration</span></code></a></p>
<p>Start Migration</p>
<p>This is a starting state migration.  It serves as a starting point
for the system before any migrations were applied and does not
itself apply any data transformations.  This migration should be used
as the first element of all migration sequences.</p>
<p>In theory, migrating back to this state should put the database back
into its original state.  By “in theory” we mean that assuming all
of the applied migrations are completely revertable which may not
be the case in all cases.</p>
</dd></dl>

<dl class="class">
<dt id="zoom.migrations.SystemMigrationRecord">
<em class="property">class </em><code class="descclassname">zoom.migrations.</code><code class="descname">SystemMigrationRecord</code><a class="headerlink" href="#zoom.migrations.SystemMigrationRecord" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="zoom.utils.html#zoom.utils.Record" title="zoom.utils.Record"><code class="xref py py-class docutils literal notranslate"><span class="pre">zoom.utils.Record</span></code></a></p>
<p>Migration Record</p>
</dd></dl>

</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">zoom</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, jw.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/source/zoom.migrations.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>